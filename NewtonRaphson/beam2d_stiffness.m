% 子程序2：整体坐标刚度矩阵
function K=beam_2d_stiffness(E,A,I,L,cs,ELG)
F=ELG(1,4);  % 单元轴力
M1=ELG(1,3); % 单元i节点弯矩
M2=ELG(1,6); % 单元j节点弯矩
T=[cs(1,1),cs(1,2),0,0,0,0;...
  -cs(1,2),cs(1,1),0,0,0,0;...
    0,0,1,0,0,0;...
    0,0,0,cs(1,1),cs(1,2),0;...
    0,0,0,-cs(1,2),cs(1,1),0;...
    0,0,0,0,0,1];
KL=[E*A/L,0,0,-E*A/L,0,0;...
    0,12*E*I/L^3,6*E*I/L^2,0,-12*E*I/L^3,6*E*I/L^2;...
    0,6*E*I/L^2,4*E*I/L,0,-6*E*I/L^2,2*E*I/L;...
    -E*A/L,0,0,E*A/L,0,0;...
    0,-12*E*I/L^3,-6*E*I/L^2,0,12*E*I/L^3,-6*E*I/L^2;...
    0,6*E*I/L^2,2*E*I/L,0,-6*E*I/L^2,4*E*I/L];
KN=[F/L,0,-M1/L,-F/L,0,-M2/L;...
    0,12*F*I/A/L^3+6*F/5/L,6*F*I/A/L^2+F/10,0,-12*F*I/A/L^3-6*F/5/L,6*F*I/A/L^2+F/10;...
    -M1/L,6*F*I/A/L^2+F/10,4*F*I/A/L+2*F*L/15,M1/L,-6*F*I/A/L^2-F/10,2*F*I/A/L-F*L/30;...
    -F/L,0,M1/L,F/L,0,M2/L;...
    0,-12*F*I/A/L^3-6*F/5/L,-6*F*I/A/L^2-F/10,0,12*F*I/A/L^3+6*F/5/L,-6*F*I/A/L^2-F/10;...
   -M2/L,6*F*I/A/L^2+F/10,2*F*I/A/L-F*L/30,M2/L,-6*F*I/A/L^2-F/10,4*F*I/A/L+2*F*L/15];
K=T'*(KL+KN)*T;
end